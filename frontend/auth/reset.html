<!DOCTYPE html>
<html>
<head>
  <title>Reset Password</title>
</head>
<body>

<h2>Reset Password</h2>

<input id="password" type="password" placeholder="New password">
<br><br>
<button onclick="resetPass()">Reset</button>

<p id="msg"></p>

<script src="../js/config.js"></script>
<script>
    const params = new URLSearchParams(window.location.search);
    const uid = params.get("uid");
    const token = params.get("token"); // already correct

    if (!uid || !token) {
        alert("Invalid or expired reset link");
        throw new Error("Missing uid or token");
    }

    function resetPass() {
        const password = document.getElementById("password").value.trim();

        if (!password) {
            alert("Password required");
            return;
        }

    fetch(API_BASE_URL + "/api/auth/reset-password/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
        uid,
        token,
        password
        })
    })
    .then(res => res.json().then(data => ({ ok: res.ok, data })))
    .then(({ ok, data }) => {
        if (!ok) throw data;
        alert("Password reset successful");
        window.location.href = "login.html";
    })
    .catch(err => {
        alert(err.error || "Reset failed. Use a fresh link.");
    });
    }
</script>

</script>


</body>
</html>
